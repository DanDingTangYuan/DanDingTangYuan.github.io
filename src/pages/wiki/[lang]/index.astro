---
/**
 * Wiki 首頁 - 多語言版本 (wiki/[lang]/index.astro)
 * 
 * 用途：
 * - 顯示特定語言的 Wiki 設定集/百科條目列表
 * - 按字母順序排列
 * - 提供條目預覽和連結
 * 
 * 路由：/wiki/[lang]
 * 
 * 例如：
 * - /wiki/zh - 顯示中文條目
 * - /wiki/ja - 顯示日文條目（如果沒有日文版本則顯示中文）
 */

import { getCollection } from "astro:content";
import BaseHead from "../../../components/BaseHead.astro";
import Footer from "../../../components/Footer.astro";
import FormattedDate from "../../../components/FormattedDate.astro";
import Header from "../../../components/Header.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../../../consts";
import { SUPPORTED_LANGUAGES, DEFAULT_LANGUAGE } from "../../../i18n/config";
import "../index.css";

/**
 * 生成靜態路徑
 * 為每個支援的語言生成一個路由
 */
export async function getStaticPaths() {
	return SUPPORTED_LANGUAGES.map((lang) => ({
		params: { lang },
	}));
}

/** 取得當前語言 */
const { lang } = Astro.params;

/** 
 * 獲取所有 Wiki 條目並按字母順序排列
 * 
 * 說明：
 * - 條目 ID 格式：'zh/entry-id' 或 'ja/entry-id'
 * - 包含所有語言的條目
 */
const allPosts = (await getCollection("wiki")).sort();

/**
 * 篩選當前語言的條目
 * 
 * 邏輯：
 * - 如果條目是該語言的版本，顯示該條目
 * - 如果條目是中文版本且當前語言沒有該條目，也顯示中文版本（fallback）
 */
const posts = allPosts.filter((post) => {
	const [postLang] = post.id.split('/');
	// 顯示該語言的條目，或中文的 fallback
	return postLang === lang || (postLang === DEFAULT_LANGUAGE && lang !== DEFAULT_LANGUAGE);
});
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
  </head>
  <body>
    <Header />
    <main>
      <section>
        <ul>
          {
            posts.map((post) => (
              <li>
                <a href={`/wiki/${post.id}`}>
                  <h4 class="title">{post.data.title}</h4>
                </a>
              </li>
            ))
          }
        </ul>
      </section>
    </main>
    <Footer />
  </body>
</html>
