---
/**
 * DevLog 首頁 (devlog/index.astro)
 * 
 * 用途：
 * - 顯示所有 DevLog 開發日誌的卡片列表
 * - 按發布日期降序排列
 * - 提供開發日誌預覽和連結
 * - 支援多語言
 * 
 * 路由：/devlog
 * 
 * 說明：
 * - 此頁面顯示所有語言的文章
 * - 文章連結會帶上語言代碼（例如 /devlog/zh/post-id）
 * - 使用卡片網格佈局，與首頁風格一致
 * - 顯示專案狀態和技術標籤
 */

import { getCollection } from "astro:content";
import BaseHead from "../../components/BaseHead.astro";
import Footer from "../../components/Footer.astro";
import FormattedDate from "../../components/FormattedDate.astro";
import Header from "../../components/Header.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../../consts";
import "./index.css";

/** 
 * 獲取所有 DevLog 文章並按發布日期排序
 * 最新的文章在最前面
 * 
 * 說明：
 * - 文章 ID 格式：'zh/post-id' 或 'ja/post-id'
 * - 包含所有語言的文章
 */
const posts = (await getCollection("devlog")).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

/** 
 * 專案狀態標籤映射 - 用於顯示中文標籤
 */
const statusLabels = {
  development: '開發中',
  maintenance: '維護中',
  fixing: '修理中',
  completed: '已完成',
  abandoned: '已棄坑'
};
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={`${SITE_TITLE} - DevLog`} description={SITE_DESCRIPTION} />
  </head>
  <body>
    {/* 頁面導航欄 */}
    <Header />
    
    <main>
      {/* 頁面標題區域 */}
      <section class="page-header">
        <h1>DevLog</h1>
        <p>開發進度和技術筆記</p>
      </section>

      {/* 開發日誌卡片網格 */}
      <section class="cards-container">
        <div class="cards-grid">
          {
            posts.map((post) => (
              <article class="devlog-card">
                {/* 卡片連結容器 */}
                <a href={`/devlog/${post.id}`} class="card-link">
                  {/* 卡片內容區域 */}
                  <div class="card-content">
                    {/* 文章標題 */}
                    <h3 class="card-title">{post.data.title}</h3>
                    
                    {/* 文章描述 */}
                    {post.data.description && (
                      <p class="card-description">{post.data.description}</p>
                    )}
                    
                    {/* 專案狀態和版本 */}
                    <div class="card-meta-info">
                      {post.data.projectStatus && (
                        <span class={`status-badge status-${post.data.projectStatus}`}>
                          {statusLabels[post.data.projectStatus]}
                        </span>
                      )}
                      {post.data.version && (
                        <span class="version-badge">v{post.data.version}</span>
                      )}
                    </div>
                    
                    {/* 技術標籤 */}
                    {post.data.tags && post.data.tags.length > 0 && (
                      <div class="card-tags">
                        {post.data.tags.slice(0, 3).map((tag) => (
                          <span class="tag">{tag}</span>
                        ))}
                      </div>
                    )}
                  </div>

                  {/* 卡片底部 - 日期和閱讀按鈕 */}
                  <div class="card-footer">
                    <span class="card-date">
                      <FormattedDate date={post.data.pubDate} />
                    </span>
                    <span class="read-more">閱讀更多 →</span>
                  </div>
                </a>

                {/* 卡片圖片區域（如果有縮圖） */}
                {post.data.thumbnail && (
                  <div class="card-image">
                    <img src={post.data.thumbnail} alt={post.data.title} />
                  </div>
                )}
              </article>
            ))
          }
        </div>
      </section>
    </main>
    
    {/* 頁面頁腳 */}
    <Footer />
  </body>
</html>
